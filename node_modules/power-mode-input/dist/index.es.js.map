{"version":3,"file":"index.es.js","sources":["../src/map.js","../src/index.js"],"sourcesContent":["export default class PMap {\n  constructor() {\n    this.list = [];\n  }\n\n  add(data) {\n    this.list.push(data);\n  }\n\n  map(callback){\n    for (let i = 0; i < this.list.length; i++) {\n      const m = this.list[i];\n      callback(m);\n    }\n  }\n\n  findByNode(node) {\n    for (let i = 0; i < this.list.length; i++) {\n      const m = this.list[i];\n      if (m[\"node\"] === node) {\n        return m;\n      }\n    }\n\n    return null;\n  }\n\n  removeByNode(node) {\n    for (let i = 0; i < this.list.length; i++) {\n      const m = this.list[i];\n      if (m[\"node\"] === node) {\n        this.list.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  removeByEmitter(emitter) {\n    for (let i = 0; i < this.list.length; i++) {\n      const m = this.list[i];\n      if (m[\"emitter\"] === emitter) {\n        this.list.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  destroy() {\n    for (let i = 0; i < this.list.length; i++) {\n      const m = this.list[i];\n      for (let key in m) {\n        delete m[key];\n      }\n    }\n\n    this.list.length = 0;\n  }\n}\n","import Proton from \"proton-engine\";\nimport RAFManager from \"raf-manager\";\nimport PMap from \"./map\";\n\nlet container, proton, defaultEmitter;\nconst piMap = new PMap();\n\nconst PowerModeInput = {\n  container: null,\n  make(node, config = {}) {\n    if (typeof node === \"string\") node = document.querySelector(node);\n    if (!container) container = createContainer();\n\n    if (!proton) {\n      proton = new Proton();\n      proton.addRenderer(createProtonRenderer(container, config));\n      RAFManager.add(renderProton);\n    }\n\n    const emitter = createEmitter(node, config);\n    proton.addEmitter(emitter);\n    addPowerEvent(node);\n    piMap.add({ emitter, node, config });\n\n    return this;\n  },\n\n  close(node) {\n    if (typeof node === \"string\") node = document.querySelector(node);\n    const { emitter } = piMap.findByNode(node);\n    proton.removeEmitter(emitter);\n    piMap.removeByNode(node);\n    removePowerEvent(node);\n    return this;\n  },\n\n  destroy() {\n    try {\n      piMap.map(({ node }) => removePowerEvent(node));\n      piMap.destroy();\n      RAFManager.remove(renderProton);\n      proton.destroy();\n    } catch (e) {}\n    return this;\n  }\n};\n\n// ~~~~~~~~~~~ PROTON FUNCTION ~~~~~~~~~~~ //\nconst createEmitter = (node, config = {}) => {\n  const emitter = new Proton.Emitter();\n  emitter.rate = config.num\n    ? new Proton.Rate(Proton.getSpan(Math.floor(config.num * 0.7), config.num), 0.1)\n    : new Proton.Rate(Proton.getSpan(6, 8), 0.1);\n\n  const life = config.life ? new Proton.Life(config.life) : new Proton.Life(0.5, 1.2);\n  const color = config.color || getDefaultColor(node);\n  const tha = config.tha ? new Proton.Span(config.tha[0], config.tha[1]) : new Proton.Span(-30, 30);\n  const v = config.v ? new Proton.Span(config.v * 0.8, config.v) : new Proton.Span(0.6, 1.2);\n\n  if (config.alpha) {\n    if (Array.isArray(config.alpha)) {\n      emitter.addBehaviour(new Proton.Alpha(config.alpha[0], config.alpha[1]));\n    } else {\n      emitter.addBehaviour(new Proton.Alpha(config.alpha));\n    }\n  } else {\n    emitter.addBehaviour(new Proton.Alpha(Proton.getSpan(0.6, 0.9)));\n  }\n\n  if (config.radius) {\n    const r = config.radius;\n    const radius = new Proton.Radius(r * 0.5, r);\n    emitter.addInitialize(radius);\n  } else {\n    const radius = new Proton.Radius(1, 2);\n    emitter.addInitialize(radius);\n  }\n\n  const g = config.g || 2.5;\n\n  if (config.random) {\n    emitter.addBehaviour(new Proton.RandomDrift(config.random, config.random, 0.2));\n  }\n\n  emitter.addInitialize(new Proton.Mass(1));\n  emitter.addInitialize(life);\n  emitter.addInitialize(new Proton.Velocity(v, tha, \"polar\"));\n  emitter.addBehaviour(new Proton.Color(color));\n  emitter.addBehaviour(new Proton.Scale(1, 0.5));\n  emitter.addBehaviour(new Proton.G(parseFloat(g)));\n  return emitter;\n};\n\nconst createProtonRenderer = (container, config) => {\n  const renderer = new Proton.DomRenderer(container);\n\n  renderer.onParticleCreated = particle => {\n    const body = renderer.pool.get(renderer.circleConf, particle);\n    body.style.width = 2 * particle.radius + \"px\";\n    body.style.height = 2 * particle.radius + \"px\";\n    body.style.marginLeft = -particle.radius + \"px\";\n    body.style.marginTop = -particle.radius + \"px\";\n\n    body.style.borderRadius = 0;\n    renderer.element.appendChild(body);\n    particle.body = body;\n  };\n\n  return renderer;\n};\n\nconst renderProton = () => {\n  proton && proton.update();\n};\n\n// ~~~~~~~~~~~ UTILS FUNCTION ~~~~~~~~~~~ //\nconst addPowerEvent = node => {\n  node.addEventListener(\"input\", inputHandler, false);\n};\n\nconst removePowerEvent = node => {\n  try {\n    node.removeEventListener(\"input\", inputHandler, false);\n    node.onpropertychange = null;\n  } catch (e) {}\n};\n\nconst inputHandler = e => {\n  const { emitter, config } = piMap.findByNode(e.currentTarget || e.target);\n  const pos = getCursorPosition(e);\n  emitter.p.x = pos.x;\n  emitter.p.y = pos.y + (config.height || config.y || 0);\n  emitter.emit(\"once\");\n};\n\n// ~~~~~~~~~~~ DOCUMENT FUNCTION ~~~~~~~~~~~ //\nconst createContainer = () => {\n  const container = document.createElement(\"div\");\n  container.style.position = \"fixed\";\n  container.style.left = \"0px\";\n  container.style.top = \"0px\";\n  container.style.zIndex = 9999;\n  container.pointerEvents = \"none\";\n  container.id = `powerinput_${(Math.random() * 999999) >> 0}`;\n  document.body.appendChild(container);\n\n  return container;\n};\n\nconst getDefaultColor = node => {\n  let color = node.style.color;\n  if (color && color !== \"inherit\") {\n  } else {\n    const copyStyle = getComputedStyle(node);\n    color = copyStyle[\"color\"];\n\n    if (color && color !== \"inherit\") {\n    } else {\n      color = \"#000000\";\n    }\n  }\n\n  if (color.indexOf(\"rgb\") === 0) {\n    color = rgbToHex(color);\n  }\n  return color;\n};\n\nconst rgbToHex = c => {\n  const rgb = c\n    .replace(/^(rgb|rgba)\\(/, \"\")\n    .replace(/\\)$/, \"\")\n    .replace(/\\s/g, \"\")\n    .split(\",\");\n\n  const r = +rgb[0];\n  const g = +rgb[1];\n  const b = +rgb[2];\n\n  return \"#\" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n};\n\nconst getCursorXY = (input, selectionPoint) => {\n  const con = document.createElement(\"div\");\n  con.style.position = \"absolute\";\n  con.style.zIndex = -99;\n  con.style.visibility = \"hidden\";\n\n  const div = document.createElement(\"div\");\n  const copyStyle = getComputedStyle(input);\n  for (const prop of copyStyle) {\n    div.style[prop] = copyStyle[prop];\n  }\n\n  const swap = \".\";\n  const inputValue = input.tagName === \"INPUT\" ? input.value.replace(/ /g, swap) : input.value;\n  // set the div content to that of the textarea up until selection\n  const textContent = inputValue.substr(0, selectionPoint);\n  div.textContent = textContent;\n  if (input.tagName === \"TEXTAREA\") div.style.height = \"auto\";\n  if (input.tagName === \"INPUT\") div.style.width = \"auto\";\n\n  // create a marker element to obtain caret position\n  const span = document.createElement(\"span\");\n  span.textContent = inputValue.substr(selectionPoint) || \".\";\n  span.style.backgroundColor = \"#ff0000\";\n  div.appendChild(span);\n  con.appendChild(div);\n  document.body.appendChild(con);\n\n  const { offsetLeft: spanX, offsetTop: spanY } = span;\n  //const rect = span.getBoundingClientRect();\n  const pos = getGlobalPosition(input);\n  document.body.removeChild(con);\n\n  return {\n    x: pos.x + spanX,\n    y: pos.y + spanY\n  };\n};\n\nconst getGlobalPosition = element => {\n  let x = 0;\n  let y = 0;\n  while (element) {\n    x += element.offsetLeft - element.scrollLeft + element.clientLeft;\n    y += element.offsetTop - element.scrollTop + element.clientTop;\n    element = element.offsetParent;\n  }\n\n  return { x, y };\n};\n\nconst getCursorPosition = e => {\n  const { currentTarget: input } = e;\n  const { start, end } = getSelection(input);\n  return getCursorXY(input, end);\n};\n\nconst getSelection = el => {\n  let start = 0,\n    end = 0,\n    normalizedValue,\n    range,\n    textInputRange,\n    len,\n    endRange;\n\n  if (typeof el.selectionStart === \"number\" && typeof el.selectionEnd === \"number\") {\n    start = el.selectionStart;\n    end = el.selectionEnd;\n  } else if (document.selection) {\n    range = document.selection.createRange();\n\n    if (range && range.parentElement() == el) {\n      len = el.value.length;\n      normalizedValue = el.value.replace(/\\r\\n/g, \"\\n\");\n      textInputRange = el.createTextRange();\n      textInputRange.moveToBookmark(range.getBookmark());\n      endRange = el.createTextRange();\n      endRange.collapse(false);\n\n      if (textInputRange.compareEndPoints(\"StartToEnd\", endRange) > -1) {\n        start = end = len;\n      } else {\n        start = -textInputRange.moveStart(\"character\", -len);\n        start += normalizedValue.slice(0, start).split(\"\\n\").length - 1;\n\n        if (textInputRange.compareEndPoints(\"EndToEnd\", endRange) > -1) {\n          end = len;\n        } else {\n          end = -textInputRange.moveEnd(\"character\", -len);\n          end += normalizedValue.slice(0, end).split(\"\\n\").length - 1;\n        }\n      }\n    }\n  } else {\n    start = end = el.value.length;\n  }\n\n  return { start, end };\n};\n\nexport default PowerModeInput;\n"],"names":["PMap","list","data","push","callback","i","length","m","node","splice","emitter","key","container","proton","piMap","PowerModeInput","config","document","querySelector","createContainer","Proton","addRenderer","createProtonRenderer","add","renderProton","createEmitter","addEmitter","findByNode","removeEmitter","removeByNode","map","removePowerEvent","destroy","remove","e","Emitter","rate","num","Rate","getSpan","Math","floor","life","Life","color","getDefaultColor","tha","Span","v","alpha","Array","isArray","addBehaviour","Alpha","radius","r","Radius","addInitialize","g","random","RandomDrift","Mass","Velocity","Color","Scale","G","parseFloat","renderer","DomRenderer","onParticleCreated","body","pool","get","circleConf","particle","style","width","height","marginLeft","marginTop","borderRadius","element","appendChild","update","addPowerEvent","addEventListener","inputHandler","removeEventListener","onpropertychange","currentTarget","target","pos","getCursorPosition","p","x","y","emit","createElement","position","left","top","zIndex","pointerEvents","id","copyStyle","getComputedStyle","indexOf","rgbToHex","rgb","c","replace","split","b","toString","slice","getCursorXY","input","selectionPoint","con","visibility","div","prop","swap","inputValue","tagName","value","textContent","substr","span","backgroundColor","spanX","offsetLeft","spanY","offsetTop","getGlobalPosition","removeChild","scrollLeft","clientLeft","scrollTop","clientTop","offsetParent","getSelection","start","end","normalizedValue","range","textInputRange","len","endRange","el","selectionStart","selectionEnd","selection","createRange","parentElement","createTextRange","moveToBookmark","getBookmark","collapse","compareEndPoints","moveStart","moveEnd"],"mappings":"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"}